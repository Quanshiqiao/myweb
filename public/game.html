<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        body{
            padding: 50px 0 0 50px;
        }
        div{
            width: 200px;
            height: 200px;
        }
        .box{
            background:url("images/game.jpg") no-repeat;
        }
        #box2{
            background-position: -200px 0;
        }
        #box3{
            background-position: -400px 0;
        }
        #box4{
            background-position: 0 -200px;
        }
        #box5{
            background-position: -200px -200px;
        }
        #box6{
            background-position: -400px -200px;
        }
        #box7{
            background-position: 0 -400px;
        }
        #box8{
            background-position: -200px -400px;
        }
        #box9{
            background-position: -400px -400px;
        }
        #btn{
            margin: 20px 0 0 200px;
            width: 200px;
            height: 50px;
            font-size: 25px;
            color: white;
            background-color: black;
            cursor: pointer;
        }
    </style>

</head>
<body>

<table border="1">
    <tr>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f1">
                <div draggable="true" ondragstart="drap(event)" id="box1" class="box"></div>
            </div>
        </td>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f2">
                <div draggable="true" ondragstart="drap(event)" id="box2" class="box"></div>
            </div>
        </td>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f3">
                <div draggable="true" ondragstart="drap(event)" id="box3" class="box"></div>
            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f4">
                <div draggable="true" ondragstart="drap(event)" id="box4" class="box"></div>
            </div>
        </td>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f5">
                <div draggable="true" ondragstart="drap(event)" id="box5" class="box"></div>
            </div>
        </td>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f6">
                <div draggable="true" ondragstart="drap(event)" id="box6" class="box"></div>
            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f7">
                <div draggable="true" ondragstart="drap(event)" id="box7" class="box"></div>
            </div>
        </td>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f8">
                <div draggable="true" ondragstart="drap(event)" id="box8" class="box"></div>
            </div>
        </td>
        <td>
            <div ondrop="drop(event)" ondragover="over(event)" id="f9">
                <div draggable="true" ondragstart="drap(event)" id="box9" class="box"></div>
            </div>
        </td>
    </tr>
</table>
<button id="btn" onclick="daluan()">开 始</button>

<script src="js/axios.min.js"></script>
<script>

    function over(e) {
        e.preventDefault();
    }
    var timer=null;
    var time=0;

    //抓起
    function drap(e) {
        var id=e.target.id;
        e.dataTransfer.setData("id",id);
    }
    //放下
    function drop(e) {
        // 获取被抓id
        var zhuaId = e.dataTransfer.getData("id");
        // 获取方向位置元素的id
        var fangId = e.target.id;


        //获取抓的元素 和 放下元素
        var zhua= document.getElementById(zhuaId);
        var fang = document.getElementById(fangId);

        //获取元素的父元素
        var zParent=zhua.parentNode;
        var fParent=fang.parentNode;

        //替换子元素
        zParent.appendChild(fang);
        fParent.appendChild(zhua);

        jiaoyan();

    }

    //校验
    function jiaoyan() {

        var count=0;
        var boxs = document.getElementsByClassName('box');

        for (var i = 0; i < boxs.length; i ++){
            var box = boxs[i];
            var fbox = box.parentNode;

            var boxId = box.getAttribute("id");
            var fboxId = fbox.getAttribute("id");

            if (boxId.replace("box", "") === fboxId.replace("f", "")) {
                count++;
            }else{
                return
            }


        }


        if (count===9){
            //浮点数运算不能保证精确值
            console.log(time.toFixed(2));
            setTimeout(function () {
                alert("恭喜你拼对了")
            },200);
            //发送请求
            axios.get('/game/test',{
                params:{
                    user_name:"路人甲1",
                    user_value:time.toFixed(2)
                }
            }).then(response=>{
                console.log(response);
            }).catch((err)=>{
                console.log(err);
            })
        }
    }

    function daluan() {

        timer=null;
        time=0;
        var boxs= document.getElementsByClassName('box');

        for (var i = 0; i < 20; i++) {
            var x = parseInt(Math.random()*9);
            var y = parseInt(Math.random()*9);

            var xbox=boxs[x].parentNode;
            var ybox=boxs[y].parentNode;

            xbox.appendChild(boxs[y]);
            ybox.appendChild(boxs[x]);
        }

        timer=setInterval(function () {
            time+=0.1;
        },100)

    }


</script>
</body>
</html>